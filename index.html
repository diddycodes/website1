<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snack Shop Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            position: relative;
            margin: 15% auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 5px;
            width: 80%;
        }

        .close {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 30px;
            color: #000;
            cursor: pointer;
        }

        /* Button styles */
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        /* Overlay styles */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
        }

        /* Admin panel styles */
        #adminPanel {
            display: none;
            padding: 20px;
        }

        #adminPanel h1 {
            font-size: 24px;
            color: #333;
        }

        /* Profile Picture Preview */
        #profilePicturePreview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
        }

        /* Trivia section */
        #triviaSection {
            margin-top: 20px;
            padding: 20px;
        }

        /* Order history section */
        .order-history-item {
            margin: 10px 0;
            padding: 10px;
            background-color: #f4f4f4;
            border-radius: 5px;
        }

        .purchase-request {
            padding: 10px;
            margin: 10px 0;
            background-color: #f8f8f8;
            border-radius: 5px;
        }

    </style>
</head>
<body>

    <!-- Admin Login Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('adminModal')">&times;</span>
            <h2>Admin Login</h2>
            <input type="text" id="username" placeholder="Username" />
            <input type="password" id="password" placeholder="Password" />
            <button onclick="loginAdmin()">Login</button>
            <p id="adminMessage"></p>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel">
        <h1>Admin Dashboard</h1>
        <div id="totalOrders">Total Orders: 0</div>
        <div id="totalSales">Total Sales: $0.00</div>
        <div id="pendingOrders">Pending Orders: 0</div>
        <ul id="onlineAdminsList"></ul>
        <div id="buyerOrders"></div>
        <button onclick="clearAllRequests()">Clear All Orders</button>
        <button onclick="logoutAdmin()">Logout</button>
    </div>

    <!-- Buyer Order Section -->
    <h2>Order History</h2>
    <div id="orderHistory"></div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <h2>Update Profile</h2>
            <input type="text" id="newName" placeholder="New Name" />
            <input type="password" id="newPassword" placeholder="New Password" />
            <input type="file" id="newPfpInput" />
            <img id="profilePicturePreview" src="" alt="Profile Picture Preview" />
            <button onclick="updateProfile()">Update Profile</button>
        </div>
    </div>

    <!-- Trivia Section -->
    <div id="triviaSection">
        <h2>Trivia</h2>
        <p id="triviaText">Snack and Animal Facts will appear here!</p>
        <button onclick="generateTrivia()">Generate Trivia</button>
        <p id="animalFact"></p>
    </div>

    <script>
        // Variables for Admin Profile
        let adminProfile = {
            username: "",
            password: "",
            displayName: "Admin",
            pfp: "admin-profile.jpg"
        };

        let isAdmin = false;
        let adminOnlineKey = null;
        let totalSales = 0;

        // Close Modal Function
        function closeModal(id) {
            document.getElementById(id).style.display = "none";
        }

        // Login Admin
        function loginAdmin() {
            const user = document.getElementById("username").value;
            const pass = document.getElementById("password").value;
            if (user === "admin" && pass === "admin123") {
                adminProfile.username = user;
                adminProfile.password = pass;
                document.getElementById("adminModal").style.display = "none";
                showLoadingOverlay();
                setTimeout(() => {
                    isAdmin = true;
                    document.getElementById("adminPanel").style.display = "block";
                    updateAdminStats();
                    addAdminOnline();
                    hideLoadingOverlay();
                }, 3000);
            } else {
                document.getElementById("adminMessage").innerHTML = "<p style='color:red;'>❌ Incorrect credentials</p>";
            }
        }

        // Show loading overlay
        function showLoadingOverlay() {
            document.getElementById("loadingOverlay").style.display = "flex";
        }

        // Hide loading overlay
        function hideLoadingOverlay() {
            document.getElementById("loadingOverlay").style.display = "none";
        }

        // Add Admin to Online List
        function addAdminOnline() {
            const ref = db.ref('adminsOnline').push({
                username: adminProfile.username,
                displayName: adminProfile.displayName,
                pfp: adminProfile.pfp,
                loginTime: Date.now()
            });
            adminOnlineKey = ref.key;
            ref.onDisconnect().remove();
        }

        // Update Admin Stats
        function updateAdminStats() {
            db.ref('orders').once('value', snapshot => {
                let totalOrders = 0;
                let totalSales = 0;
                let pendingOrders = 0;
                for (let key in snapshot.val()) {
                    totalOrders++;
                    const order = snapshot.val()[key];
                    totalSales += order.price;
                    if (!order.confirmed) {
                        pendingOrders++;
                    }
                }
                document.getElementById("totalOrders").textContent = `Total Orders: ${totalOrders}`;
                document.getElementById("totalSales").textContent = `Total Sales: $${totalSales.toFixed(2)}`;
                document.getElementById("pendingOrders").textContent = `Pending Orders: ${pendingOrders}`;
            });
        }

        // Admin Logout
        function logoutAdmin() {
            isAdmin = false;
            adminProfile = { username: "", password: "", displayName: "Admin", pfp: "admin-profile.jpg" };
            document.getElementById("adminPanel").style.display = "none";
            document.getElementById("adminModal").style.display = "flex";
        }

        // Generate Snack and Animal Trivia
        const snackTrivia = [
            "Did you know that the first potato chip was made by accident in 1853?",
            "Oreo cookies were first introduced in 1912.",
            "Gushers were introduced by Betty Crocker in the 1990s.",
            "Red Bull contains taurine, a naturally occurring amino acid.",
            "Oreos are the best-selling cookies in the United States."
        ];

        const animalTrivia = [
            "A group of flamingos is called a 'flamboyance.'",
            "Elephants are the only animals that can’t jump.",
            "A lion’s roar can be heard from 5 miles away.",
            "A giraffe's neck has the same number of bones as a human neck.",
            "Cows have best friends and get stressed when they are separated."
        ];

        function generateTrivia() {
            const randomIndex = Math.floor(Math.random() * snackTrivia.length);
            const randomAnimalIndex = Math.floor(Math.random() * animalTrivia.length);
            document.getElementById("triviaText").textContent = `${snackTrivia[randomIndex]} \n\n Animal Fact: ${animalTrivia[randomAnimalIndex]}`;
        }

        // Update Profile
        function updateProfile() {
            const newName = document.getElementById("newName").value;
            const newPassword = document.getElementById("newPassword").value;
            const newPfp = document.getElementById("newPfpInput").files[0];
            if (newName) adminProfile.displayName = newName;
            if (newPassword) adminProfile.password = newPassword;
            if (newPfp) {
                const reader = new FileReader();
                reader.onload = function () {
                    adminProfile.pfp = reader.result;
                    document.getElementById("profilePicturePreview").src = reader.result;
                };
                reader.readAsDataURL(newPfp);
            }
            alert("Profile updated successfully!");
            closeModal('profileModal');
        }

        // Profile Picture Preview
        document.getElementById("newPfpInput").addEventListener("change", function () {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById("profilePicturePreview").src = e.target.result;
            };
            reader.readAsDataURL(this.files[0]);
        });

        // Close Profile Modal
        function closeProfileModal() {
            document.getElementById("profileModal").style.display = "none";
        }
    </script>
</body>
</html>

